<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>TOPUP BD</title>
<style>
/* ... ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ CSS ‡¶è‡¶∞ ‡¶Ö‡¶®‡ßá‡¶ï‡¶ü‡¶æ‡¶á ‡¶Ö‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§ ‡¶∞‡¶æ‡¶ñ‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá; ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶¨‡¶æ‡¶ü‡¶®‡ßá‡¶∞ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤‡¶ø‡¶Ç ‡¶ì ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü-‡¶ü‡ßã‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá ... */
*{margin:0;padding:0;box-sizing:border-box;font-family:"Poppins",sans-serif}
body{min-height:100vh;color:#222;background:#E1D4C1; no-repeat center center fixed;background-size: cover;animation:none;}
header{background:#E1D4C1;color:#FF1493;text-align:center;padding:14px 20px;font-size:1.1em;font-weight:700;border-radius:80px;box-shadow:0 6px 25px rgba(127,0,255,0.4);position:sticky;top:12px;z-index:120;letter-spacing:0px;text-transform:uppercase;overflow:hidden;animation:glowPulse 4s ease-in-out infinite;}
header::before{content:"";position:absolute;top:0;left:-100%;width:20%;height:100%;background:linear-gradient(120deg,rgba(255,255,255,0.3),rgba(255,255,255,0));transform:skewX(-25deg);animation:headerShine 3.5s infinite;}
@keyframes headerShine{0%{left:-100%;}50%{left:130%;}100%{left:130%;}}
@keyframes glowPulse{0%,100%{box-shadow:0 0 25px rgba(127,0,255,0.5);}50%{box-shadow:0 0 45px rgba(255,106,0,0.6);}}
.shop-name-wrapper{display:flex;justify-content:center;align-items:center;margin:25px 0;}
.shop-name{background:#E1D4C1;color:#FF1493;padding:20px 45px;font-size:1.3em;font-weight:700;border-radius:100px;box-shadow:0 8px 25px rgba(238,9,121,0.4);text-transform:uppercase;letter-spacing:0px;position:relative;overflow:hidden;animation:shine 4s linear infinite;}
.shop-name::before{content:"";position:absolute;top:0;left:-75%;width:50%;height:100%;background:linear-gradient(120deg,rgba(255,255,255,0.3),rgba(255,255,255,0));transform:skewX(-25deg);animation:slide 3s infinite;}
@keyframes slide{0%{left:-75%;}50%{left:125%;}100%{left:125%;}}
@keyframes shine{0%,100%{box-shadow:0 0 20px rgba(238,9,121,0.4);}50%{box-shadow:0 0 35px rgba(255,106,0,0.6);}}
.container{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:16px;padding:20px;margin-top:8px;}
.product{background:#987284;border-radius:18px;overflow:hidden;box-shadow:0 8px 20px rgba(0,0,0,0.1);transition:all .3s ease;cursor:pointer;border:2px solid rgba(0,0,0,0.05);position:relative;}
.product:hover{transform:translateY(-8px) scale(1.03);box-shadow:0 12px 26px rgba(0,0,0,0.18);background:linear-gradient(145deg,#ff84bd,#ff60a8);}
.product::before{content:"";position:absolute;inset:0;border-radius:18px;background:radial-gradient(circle at 30% 30%,rgba(255,192,203,0.4),transparent 60%),radial-gradient(circle at 70% 70%,rgba(255,255,255,0.3),transparent 60%);opacity:0;transition:opacity .4s ease;}
.product:hover::before{opacity:1;}
.product img{width:100%;height:180px;object-fit:contain;transition:.3s;}
.product:hover img{transform:scale(1.07);}
.product-info{padding:12px 10px;text-align:center;background:rgba(255,255,255,0.85);}
.product-info h3{font-size:1em;font-weight:600;margin-bottom:6px;color:#111;}
.product-info p{color:#ff007f;font-weight:700;font-size:0.95em;}
#productPage{display:none;padding:16px;min-height:70vh}
.productPageWrapper{display:flex;gap:20px;align-items:flex-start;justify-content:center;flex-wrap:wrap;background:#A5F1F6;border-radius:18px;padding:20px;box-shadow:0 8px 25px rgba(0,0,0,0.15);}
.imagesColumn{flex:1;display:flex;gap:16px;max-width:800px;}
.imagesColumn .imgWrap{flex:1;background:#fff;border-radius:120px;overflow:hidden;box-shadow:0 6px 18px rgba(0,0,0,.08);opacity:0;transform:translateY(20px);animation:fadeSlide 0.5s forwards;}
.imagesColumn .imgWrap:nth-child(1){animation-delay:0.1s;}
@keyframes fadeSlide{to{opacity:1;transform:translateY(0);}}
.imagesColumn img{width:100%;height:auto;max-height:300px;object-fit:contain;display:block;cursor:pointer;border-radius:12px;}
.fullscreen-view{position:fixed;inset:0;background:rgba(0,0,0,0.9);display:flex;justify-content:center;align-items:center;z-index:9999;animation:fadeIn .3s ease;}
.fullscreen-view img{max-width:80%;max-height:80%;border-radius:12px;box-shadow:0 0 20px rgba(255,255,255,0.3);}
.fullscreen-view.closeable{cursor:pointer;}
.orderColumn{width:120px;background:linear-gradient(180deg,#ffffff,#fbfbfb);border-radius:12px;padding:18px;box-shadow:0 8px 30px rgba(0,0,0,.08);display:flex;flex-direction:column;gap:12px;align-items:center;position:sticky;top:84px;height:fit-content}
.orderColumn h2{font-size:1.25em;text-align:center}
.orderColumn .price{font-weight:700;font-size:1.05em;color:#111}
.orderColumn .desc{font-size:0.95em;color:#444;text-align:center}
.paymentBox{width:100%;background:000000;color:#000000;border-radius:30px;padding:10px;text-align:center;font-weight:600;box-shadow:0 5px 15px rgba(127,0,255,0.3);position:relative;}
.copyBtn{background:#A5F1F6;color:#000000;font-size:0.8em;padding:4px 8px;border-radius:8px;border:none;cursor:pointer;margin-top:6px;transition:.3s;}
.copyBtn:hover{background:#ffe5ff;color:#e100ff;}
.bigBtn{display:inline-block;background:#740E4C;color:#FFF4DF;padding:14px 22px;border-radius:30px;text-decoration:none;font-weight:700;font-size:1.05em;box-shadow:0 8px 18px rgba(37,211,102,.25);border:none;transition:.3s;}
.bigBtn:hover{transform:scale(1.05);}
.bigBtn:active{transform:translateY(1px)}
.phone{display:none;}
.share-note{font-size:0.82em;color:#666;text-align:center;padding-top:6px}
.product-desc-frame{background:#FFFAF0;color:#000000;border:none;box-shadow:0 5px 20px rgba(127,0,255,0.4);padding:20px 25px;border-radius:16px;text-align:center;font-size:1.05em;font-weight:500;margin-bottom:25px;animation:fadeIn .4s ease;transition:all .3s ease;}
#orderFormPage{display:none;text-align:center;padding:20px;}
.orderFormFrame{background: #FFF4DF;padding:25px 20px;border-radius:20px;box-shadow:0 8px 25px rgba(255,75,43,0.4);color:#000000;max-width:400px;margin:0 auto;animation:fadeIn .5s ease;}
.orderFormFrame h2{margin-bottom:15px;font-size:1.4em;font-weight:600;}
.orderFormFrame p{margin-bottom:15px;font-size:0.95em;font-weight:500;}
.orderFormFrame input{width:90%;padding:10px;margin:10px 0;border-radius:10px;border:none;outline:none;}
.orderFormFrame button{background:#740E4C;color:#fff;padding:12px 20px;border:none;border-radius:12px;font-weight:600;cursor:pointer;transition:.3s;}
.orderFormFrame button:hover{transform:scale(1.05);}
.orderFormFrame #orderMsg{margin-top:12px;font-weight:600;}

/* ===== UPDATED BACK BUTTON: Improved Bengali tone, refined design & sizing =====
   - New friendly Bengali label
   - Slightly smaller, elegant pill
   - Good contrast and subtle elevation
   - Visible placement right where the UI expects it (keeps document flow)
*/
.backBtn{
  display:inline-block;
  padding:8px 18px;
  margin-bottom:14px;
  background: linear-gradient(135deg,#fff4fb,#ffd9f7);
  color:#7a003f;
  border-radius:999px;              /* pill shape */
  cursor:pointer;
  font-weight:700;
  font-size:0.98em;
  letter-spacing:0.2px;
  box-shadow: 0 8px 20px rgba(122,0,64,0.12);
  border: 1px solid rgba(122,0,64,0.08);
  transition: transform .16s cubic-bezier(.2,.9,.2,1), box-shadow .18s ease, background .18s ease;
  position:relative;               /* keeps it in normal flow so it won't overlap content */
  text-decoration:none;
  display:flex;
  align-items:center;
  gap:10px;
  justify-content:center;
}

/* small left arrow icon style (using simple character for compatibility) */
.backBtn .backIcon{ font-size:1.05em; transform:translateX(-1px); }

/* hover: lift slightly and deepen color */
.backBtn:hover{
  transform: translateY(-3px) scale(1.02);
  box-shadow: 0 14px 34px rgba(122,0,64,0.18);
  background: linear-gradient(135deg,#fff8fd,#ffeff9);
}

/* active/tap feedback */
.backBtn:active{
  transform: translateY(0) scale(0.99);
}

/* accessible focus state */
.backBtn:focus{
  outline:3px solid rgba(255,175,218,0.28);
  outline-offset:4px;
}

/* For very small screens reduce the size so it never obstructs content */
@media(max-width:420px){
  .backBtn{ padding:7px 14px; font-size:0.92em; margin-bottom:12px; }
}

/* other modals and profile stuff left unchanged */
.authModal{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;justify-content:center;align-items:center;z-index:1500;}
.authBox{background:#fff;padding:20px;border-radius:12px;max-width:420px;width:92%;box-shadow:0 12px 30px rgba(0,0,0,0.3);text-align:center;}
.tabBtns{display:flex;gap:8px;justify-content:center;margin-bottom:12px;}
.tabBtns button{flex:1;padding:10px;border-radius:8px;border:none;cursor:pointer;font-weight:700;}
.tabActive{background:#740E4C;color:#fff;}
.tabInactive{background:#f0f0f0;color:#333;}
.authBox input{width:90%;padding:10px;margin:8px auto;border-radius:8px;border:1px solid #ddd;}
.smallNote{font-size:0.85em;color:#666;margin-top:6px}

/* Profile modal & other improved UI */
#profileModal { display:none; position:fixed; z-index:3000; inset:0; background:rgba(0,0,0,0.55); justify-content:center; align-items:center; animation:fadeIn .23s; }
.profileModalFrame{ background:#fff; padding:34px 36px 26px 36px; border-radius:38px; box-shadow:0 8px 40px rgba(127,0,255,0.20),0 3px 10px rgba(0,0,0,0.08); min-width:270px; max-width:99vw; text-align:center; position:relative; animation:fadeIn 0.17s; }
.profileModalFrame .profileBigIcon{ font-size:3.5em; background:linear-gradient(120deg,#d9afe8,#e1f0ff); color:#691060; border-radius:50%; width:70px; height:70px; display:flex;align-items:center;justify-content:center;margin:0 auto 14px; border-bottom:2px solid #ffb5f8;border-left:2px solid #dcbbff; box-shadow:0 2px 11px #ffdae6; }
.profileModalFrame .profileTitle{ font-size:1.3em; font-weight:700; color:#8a0a72; margin-bottom:6px; }
.profileModalFrame .profileField{ margin-bottom:7px; font-size:1em; }
.profileModalFrame .profileLabel{ font-weight:bold;color:#8900b4;margin-right:4px; }
.profileModalFrame .closeProfileBtn{ display:inline-block;padding:9px 33px;border-radius:22px; background:#ba0e5b;color:#fff;font-weight:600;font-size:1em; border:none;cursor:pointer;transition:.15s;margin-top:12px; box-shadow:0 2px 10px #ffc1e0; }
.profileModalFrame .closeProfileBtn:hover{ background:#740E4C; color:#fffbea; box-shadow:0 4px 15px #ffd7fa; }
.profileModalFrame .profileLoginBtnWrap { margin-top: 14px; }
.profileModalFrame .profileLoginBtn { background: #740E4C; color: #FFF4DF; padding: 11px 22px; border-radius: 30px; font-weight: 700; border: none; font-size: 1.04em; box-shadow: 0 8px 18px rgba(152,40,126,0.13); cursor:pointer; transition:.2s; margin-bottom:8px; }
.profileModalFrame .profileLoginBtn:hover { background:#ff5eb0; color:#fff; transform: scale(1.04); }

/* Order alert modal */
#orderAlertModal{ display:none; position:fixed; z-index:2000; inset:0; background:rgba(25,5,40,0.35); backdrop-filter: blur(1.5px); justify-content:center; align-items:center; animation:fadeIn .20s; }
.orderAlertFrame{ background:linear-gradient(120deg,#fff6fa 80%, #fffcfe 100%); border-radius: 24px; box-shadow: 0 8px 36px rgba(233,50,141,0.18), 0 1.5px 4.5px rgba(0,0,0,0.07); padding:38px 28px 28px 28px; max-width:340px; width:96%; text-align:center; border: 1.5px solid #ff80c6; position:relative; animation:fadeIn 0.15s; }
.orderAlertFrame .alertIcon{ font-size:2.3em; line-height:1; color:#ee158e; margin-bottom:11px; filter: drop-shadow(0 4px 12px #ffdde6); }
.orderAlertFrame .alertTitle{ font-size:1.14em; font-weight:700; color:#99005c; margin-bottom:7px; letter-spacing:0.5px; }
.orderAlertFrame .alertMsg{ color:#3d2040; font-size:1em; margin-bottom:18px; white-space: pre-line; }
.orderAlertFrame .alertBtn{ display:inline-block; padding:9px 38px; border-radius: 18px; background:#ff64af; color:#fff; font-weight:600; font-size:1em; border:none; cursor:pointer; transition:.17s; box-shadow:0 2px 10px #ffdae6; }
.orderAlertFrame .alertBtn:hover{ background:#99005c; color:#fffbea; box-shadow:0 5px 16px #ffc1e0; }

@media (max-width:880px){
  .container{grid-template-columns:repeat(2,1fr)}
  .product img{max-height:180px}
  .productPageWrapper{flex-direction:column;align-items:center}
  .orderColumn{width:92%;position:static;top:auto}
  .imagesColumn{flex-direction:row;gap:12px}
  .imagesColumn img{max-height:200px}
  .orderFormFrame{width:95%;padding:20px;}
}
@media (max-width:480px){
  .container{grid-template-columns:repeat(2,1fr);gap:10px;padding:10px}
  .product img{max-height:160px}
  .imagesColumn img{max-height:180px}
  .bigBtn{padding:12px 18px;font-size:1em}
  .orderFormFrame input{width:95%;}
  .orderAlertFrame{padding:29px 6vw 20px;}
}

/* ===== loggedInfo/profile button styling (unchanged premium) ===== */
.loggedInfo{
  position:fixed;
  right:22px;
  top:18px;
  background: linear-gradient(180deg, rgba(255,255,255,0.85), rgba(250,245,255,0.75));
  padding:6px;
  border-radius:999px;
  box-shadow:0 6px 20px rgba(18, 6, 38, 0.28), inset 0 1px 0 rgba(255,255,255,0.6);
  display:flex;
  gap:8px;
  align-items:center;
  z-index:1800;
  transition:transform .18s ease, box-shadow .18s ease;
  backdrop-filter: blur(6px) saturate(120%);
  -webkit-backdrop-filter: blur(6px) saturate(120%);
}
.loggedInfo:hover{ transform: translateY(-3px) scale(1.02); box-shadow:0 10px 34px rgba(18, 6, 38, 0.32), inset 0 1px 0 rgba(255,255,255,0.72); }
.logoutBtn{ background: linear-gradient(135deg,#ffeff8,#ffe6ff); color:#7a003f; font-weight:800; border:none; border-radius:50%; width:56px; height:56px; display:flex; align-items:center; justify-content:center; font-size:1.25em; transition: transform .16s cubic-bezier(.2,.9,.2,1), box-shadow .16s; box-shadow:0 6px 18px rgba(122,0,64,0.18), 0 1px 0 rgba(255,255,255,0.6) inset; cursor:pointer; outline: none; position:relative; }
.logoutBtn:hover{ transform: translateY(-3px) scale(1.03); box-shadow:0 14px 36px rgba(122,0,64,0.22), 0 1px 0 rgba(255,255,255,0.72) inset; background: linear-gradient(135deg,#fff4fb,#ffd9f7); }
.logoutBtn:active{ transform: translateY(0) scale(0.99); }
.logoutBtn::after{ content: ""; position: absolute; inset: -6px; border-radius: 50%; pointer-events: none; background: radial-gradient(circle at 30% 20%, rgba(255,255,255,0.14), rgba(255,255,255,0)); opacity: 0.95; }
.logoutBtn svg{ width:26px; height:26px; color: inherit; }
.loggedInfo .userLabel{ display:none; font-weight:700; color:#520033; font-size:0.92em; padding:0 8px 0 4px; white-space:nowrap; align-self:center; }
@media(min-width:980px){ .loggedInfo{ right:28px; top:20px; } .loggedInfo .userLabel{ display:inline-block; } .logoutBtn{ width:56px; height:56px; } }
@media(max-width:420px){ .loggedInfo{ right:12px; top:10px; padding:4px; } .logoutBtn{ width:48px; height:48px; font-size:1.05em; } .logoutBtn svg{ width:22px; height:22px; } }

/* END CSS */
</style>
</head>
<body>
<!-- NOTE: Header element intentionally removed as requested -->
<div class="shop-name-wrapper" id="shopNameWrapper">
  <div class="shop-name" id="shopNameDiv">ùêçùêûùê≠ùê∞ùê®ùê´ùê§ ùêèùê´ùê®ùêõùê•ùêûùó∫</div>
</div>

<div id="home" class="container" aria-live="polite"></div>

<!-- Stylish Modal for order without account -->
<div id="orderAlertModal" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="orderAlertFrame" role="document">
    <div class="alertIcon" aria-hidden="true">üö´</div>
    <div class="alertTitle">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶õ‡¶æ‡¶°‡¶º‡¶æ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶®‡¶Ø‡¶º!</div>
    <div class="alertMsg">
‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶®..!!
    </div>
    <button class="alertBtn" onclick="closeOrderAlertModal()" aria-label="‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®">‡¶ï‡ßç‡¶≤‡ßã‡¶ú</button>
  </div>
</div>

<!-- AUTH MODAL (Register & Login) -->
<div class="authModal" id="authModal" aria-hidden="true">
  <div class="authBox" id="authBox" role="dialog" aria-modal="true" aria-labelledby="authTitle">
    <div class="tabBtns" role="tablist" aria-label="Authentication Tabs">
      <button id="regTab" class="tabActive" onclick="switchAuthTab('register')" role="tab" aria-selected="true">Register</button>
      <button id="loginTab" class="tabInactive" onclick="switchAuthTab('login')" role="tab" aria-selected="false">Login</button>
    </div>

    <!-- REGISTER -->
    <div id="registerPanel">
      <input type="text" id="regFullName" placeholder="Full Name" aria-label="‡¶™‡ßÅ‡¶∞‡¶æ ‡¶®‡¶æ‡¶Æ"/>   <!-- ‚úÖ ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶ø‡¶≤‡ßç‡¶° -->
      <input type="text" id="regUsername" placeholder="Username " aria-label="‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ"/>
      <input type="email" id="regEmail" placeholder="Enter your email (optional)" aria-label="‡¶á‡¶Æ‡ßá‡¶á‡¶≤ (‡¶Ö‡¶™‡¶∂‡¶®‡¶æ‡¶≤)"/>
      <input type="password" id="regPassword" placeholder="Password" aria-label="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°"/>
      <input type="password" id="regConfirm" placeholder="Confirm Password" aria-label="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®"/>
      <button onclick="createAccount()" class="bigBtn" style="padding:10px 16px;margin-top:8px;">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
      <p id="regMsg" class="smallNote" role="status"></p>
      <div style="margin-top:8px;"><button class="backBtn" onclick="closeAuthModal()" aria-label="‡¶Æ‡ßã‡¶°‡¶º‡¶æ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®"><span class="backIcon">‚Üê</span> ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®</button></div>
    </div>

    <!-- LOGIN -->
    <div id="loginPanel" style="display:none;">
      <input type="email" id="loginEmail" placeholder="Enter Your Gmail or Username" aria-label="‡¶á‡¶Æ‡ßá‡¶á‡¶≤/‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ" />
      <input type="password" id="loginPassword" placeholder="Password" aria-label="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°"/>
      <button onclick="loginUser()" class="bigBtn" style="padding:10px 16px;margin-top:8px;">‡¶≤‡¶ó‡¶á‡¶®</button>
      <p id="loginMsg" class="smallNote" role="status"></p>
      <div style="margin-top:8px;"><button class="backBtn" onclick="closeAuthModal()" aria-label="‡¶Æ‡ßã‡¶°‡¶º‡¶æ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®"><span class="backIcon">‚Üê</span> ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®</button></div>
    </div>
  </div>
</div>

<!-- LOGGED INFO (show ALWAYS for profile button) -->
<div id="loggedInfo" class="loggedInfo" style="display:flex;" aria-hidden="false">
  <button class="logoutBtn" id="profileBtn" title="Profile & Logout" onclick="openProfileModal()" aria-label="‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶ì ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü">
    <svg width="23" height="23" fill="none" viewBox="0 0 48 48" aria-hidden="true"><circle cx="24" cy="15.5" r="7" stroke="currentColor" stroke-width="3"/><path d="M10 38c0-5.523 6.268-10 14-10s14 4.477 14 10" stroke="currentColor" stroke-width="3" stroke-linecap="round"/></svg>
  </button>
  <div class="userLabel" id="userLabel" style="display:none;"></div>
</div>

<!-- Profile Modal (Now supports not-logged-in account creation option) -->
<div id="profileModal" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="profileModalFrame" role="document">

    <div class="profileBigIcon" aria-hidden="true"><svg width="48" height="48" fill="none" viewBox="0 0 48 48"><circle cx="24" cy="15.5" r="13" fill="#e0cafb"/><circle cx="24" cy="15.5" r="7" stroke="#800066" stroke-width="3"/><path d="M10 38c0-5.523 6.268-10 14-10s14 4.477 14 10" stroke="#800066" stroke-width="3" stroke-linecap="round"/></svg></div>
    <div class="profileTitle" id="profileModalTitle">Profile Info</div>
    <div id="profileFields">
      <div class="profileField"><span class="profileLabel">Full Name:</span> <span id="profileFullName"></span></div>
      <div class="profileField"><span class="profileLabel">Username:</span> <span id="profileUserName"></span></div>
      <div class="profileField"><span class="profileLabel">Email:</span> <span id="profileEmail"></span></div>
      <button class="closeProfileBtn" onclick="closeProfileModal()" aria-label="‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®">Close</button>
      <button class="closeProfileBtn" style="background:#cf1761;margin-top:7px;" onclick="logoutUser()" aria-label="‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®">Logout</button>
    </div>
    <div id="profileLoginOption" style="display:none; flex-direction:column; align-items:center;">
      <div class="profileLoginBtnWrap">
        <button class="profileLoginBtn" onclick="openCreateAccount(event)" aria-label="‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø/‡¶≤‡¶ó‡¶á‡¶®">‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø / ‡¶≤‡¶ó‡¶á‡¶®</button>
      </div>
      <button class="closeProfileBtn" onclick="closeProfileModal()" style="margin-top:8px;">Close</button>
    </div>
  </div>
</div>

<!-- Create Account Page (standalone) -->
<div id="createAccountPage" style="display:none;text-align:center;padding:20px;" aria-hidden="true">
  <div class="orderFormFrame">
    <button class="backBtn" onclick="goBack('createAccountPage')" aria-label="‡¶™‡ßÇ‡¶∞‡ßç‡¶¨ ‡¶™‡ßÉ‡¶∑‡ßç‡¶†‡¶æ‡¶Ø‡¶º ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®"><span class="backIcon">‚Üê</span> ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®</button>
    <h2>‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
    <input type="text" id="newFullName" placeholder="Full Name" aria-label="‡¶™‡ßÅ‡¶∞‡¶æ ‡¶®‡¶æ‡¶Æ" />
    <input type="text" id="newUsername" placeholder="Username" aria-label="‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ" />
    <input type="password" id="newPassword" placeholder="Password" aria-label="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°" />
    <input type="password" id="confirmPassword" placeholder="Confirm Password" aria-label="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®" />
    <button onclick="createAccountFromPage()" class="bigBtn">‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    <p id="accountMsg" class="smallNote" role="status"></p>
  </div>
</div>

<div id="orderFormPage" aria-hidden="true">
  <div class="orderFormFrame">
    <button class="backBtn" onclick="goBack('orderFormPage')" aria-label="‡¶™‡¶£‡ßç‡¶Ø ‡¶™‡ßÉ‡¶∑‡ßç‡¶†‡¶æ‡¶Ø‡¶º ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®"><span class="backIcon">‚Üê</span> ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®</button>
    <h2>‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
    <p>‡¶Ø‡ßá‡¶á ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡¶æ‡¶†‡¶ø‡ßü‡ßá‡¶õ‡ßá‡¶® ‡¶ì‡¶á ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶∞‡ßá‡¶∞ ‡¶∂‡ßá‡¶∑ ‡ß™ ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü ‡¶è‡¶¨‡¶Ç UID ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..!!</p>
    <input type="text" id="lastFourDigits" maxlength="4" placeholder="‡¶∂‡ßá‡¶∑ 4 ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü" />
    <input type="text" id="userUID" placeholder="UID ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" />
    <button onclick="confirmOrder()" class="bigBtn">‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    <p id="orderMsg"></p>
  </div>
</div>

<div id="productPage" aria-hidden="true">
  <button class="backBtn" onclick="goBack('productPage')" aria-label="‡¶π‡ßã‡¶Æ ‡¶™‡ßÉ‡¶∑‡ßç‡¶†‡¶æ‡¶Ø‡¶º ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®"><span class="backIcon">‚Üê</span> ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®</button>
  <div class="product-desc-frame" id="productDescFrame"></div>
  <div class="productPageWrapper">
    <div class="imagesColumn" id="detailImagesColumn" aria-live="polite"></div>
    <div class="orderColumn" id="orderColumn">
      <div class="sendMoneyBox">üí∏ ‡¶∏‡ßá‡¶®‡ßç‡¶° ‡¶Æ‡¶æ‡¶®‡¶ø üëá</div>
      <div class="paymentBox">
        ‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞‡¶É <br>
        <strong id="bkashNumber">01780526790</strong><br>
        <button class="copyBtn" onclick="copyText('bkashNumber')" aria-label="‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®">üìã ‡¶ï‡¶™‡¶ø</button>
      </div>
      <div class="paymentBox">
        ‡¶®‡¶ó‡¶¶ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞‡¶É <br>
        <strong id="nagadNumber">01709353246</strong><br>
        <button class="copyBtn" onclick="copyText('nagadNumber')" aria-label="‡¶®‡¶ó‡¶¶ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®">üìã ‡¶ï‡¶™‡¶ø</button>
      </div>
      <h2 id="detailName">Product Name</h2>
      <div class="price" id="detailPrice">‡ß≥ 0</div>
      <!-- Order Now button -->
      <a id="orderBtn" class="bigBtn" href="#" role="button" aria-label="‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®">‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</a>
      <div class="share-note">‡¶â‡¶™‡¶∞‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶™‡ßá‡¶ú‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá..!</div>
    </div>
  </div>
</div>

<!-- firebase libs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCMw9hLWC0-FDA-w5Zw4mztJ_Gf6hi70RA",
  authDomain: "t-shop-451db.firebaseapp.com",
  databaseURL: "https://t-shop-451db-default-rtdb.firebaseio.com/",
  projectId: "t-shop-451db",
  storageBucket: "t-shop-451db.firebasestorage.app",
  messagingSenderId: "207345638429",
  appId: "1:207345638429:web:82c5a5199e73ce1640faf4",
  measurementId: "G-L1Z0DJC4PS"
};
firebase.initializeApp(firebaseConfig);
const dbRef = firebase.database().ref("/");
let shopNameDiv = document.getElementById("shopNameDiv");
// header element intentionally removed; keep variable but it may be null
let header = document.getElementById("mainHeader");
let homeContainer = document.getElementById('home');
let selectedProduct = null;

// --- Auth UI helpers ---
const authModal = document.getElementById('authModal');
const registerPanel = document.getElementById('registerPanel');
const loginPanel = document.getElementById('loginPanel');
const regMsg = document.getElementById('regMsg');
const loginMsg = document.getElementById('loginMsg');

// Profile Modal
const profileModal = document.getElementById('profileModal');
const profileModalTitle = document.getElementById('profileModalTitle');
const profileFields = document.getElementById('profileFields');
const profileLoginOption = document.getElementById('profileLoginOption');
const profileFullName = document.getElementById('profileFullName');
const profileUserName = document.getElementById('profileUserName');
const profileEmail = document.getElementById('profileEmail');
let cachedProfileInfo = {};

// Modal elements for order restriction
const orderAlertModal = document.getElementById('orderAlertModal');

// ----------------- AUTH FUNCTIONS -----------------
function openOrderAlertModal(){
  orderAlertModal.style.display = 'flex';
  orderAlertModal.setAttribute('aria-hidden','false');
}
function closeOrderAlertModal(){
  orderAlertModal.style.display = 'none';
  orderAlertModal.setAttribute('aria-hidden','true');
}

/*
  FIX: ensure profile modal is closed before opening the register/login modal.
  Also stop propagation when button clicked, and use a tiny delay so UI doesn't
  stack two modals (that caused the "double registration" experience).
*/
function openCreateAccount(e){
  if(e && typeof e.stopPropagation === 'function') e.stopPropagation();
  closeProfileModal();
  setTimeout(()=>{
    authModal.style.display='flex';
    authModal.setAttribute('aria-hidden','false');
    switchAuthTab('register');
  }, 120);
}

function closeAuthModal(){
  authModal.style.display='none';
  authModal.setAttribute('aria-hidden','true');
  regMsg.innerText=''; loginMsg.innerText='';
}
function switchAuthTab(tab){
  if(tab==='register'){
    registerPanel.style.display='block';
    loginPanel.style.display='none';
    document.getElementById('regTab').className='tabActive';
    document.getElementById('loginTab').className='tabInactive';
    document.getElementById('regTab').setAttribute('aria-selected','true');
    document.getElementById('loginTab').setAttribute('aria-selected','false');
  } else {
    registerPanel.style.display='none';
    loginPanel.style.display='block';
    document.getElementById('regTab').className='tabInactive';
    document.getElementById('loginTab').className='tabActive';
    document.getElementById('regTab').setAttribute('aria-selected','false');
    document.getElementById('loginTab').setAttribute('aria-selected','true');
  }
}

// Utility: escape HTML
function escapeHtml(s){return String(s).replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));}

async function createAccount(){
  regMsg.style.color='black';
  regMsg.innerText='Processing...';
  const fullName = document.getElementById('regFullName').value.trim();
  const username = document.getElementById('regUsername').value.trim();
  const emailInput = document.getElementById('regEmail').value.trim();
  const pass = document.getElementById('regPassword').value;
  const confirm = document.getElementById('regConfirm').value;
  if(!fullName){ regMsg.style.color='red'; regMsg.innerText='Full Name ‡¶¶‡¶ø‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§'; return; }
  if(!username){ regMsg.style.color='red'; regMsg.innerText='Username ‡¶¶‡¶ø‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§'; return; }
  if(!pass || !confirm){ regMsg.style.color='red'; regMsg.innerText='Password ‡¶ì Confirm ‡¶ö‡¶æ‡¶á‡•§'; return; }
  if(pass !== confirm){ regMsg.style.color='red'; regMsg.innerText='Password ‡¶Æ‡¶ø‡¶≤‡¶õ‡ßá ‡¶®‡¶æ‡•§'; return; }
  let email = emailInput;
  if(!email){
    let san = username.replace(/\s+/g,'').toLowerCase();
    if(!san) san = 'user' + Date.now();
    email = san + '@gmail.com';
  }
  try{
    await firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL);
    const userCred = await firebase.auth().createUserWithEmailAndPassword(email, pass);
    await userCred.user.updateProfile({displayName: username});
    const userId = userCred.user.uid;
    await firebase.database().ref('users/' + userId).set({
      username: username,
      fullName: fullName,
      email: email,
      createdAt: new Date().toISOString()
    });
    cachedProfileInfo = {
      fullName: fullName,
      username: username,
      email: email
    };
    regMsg.style.color='green';
    regMsg.innerText='‚úÖ ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶∏‡¶´‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶è‡¶ñ‡¶® ‡¶≤‡¶ó‡¶á‡¶® ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡ßü ‡¶Ü‡¶õ‡ßã‡•§';
    setTimeout(()=>{ closeAuthModal(); },900);
  }catch(err){
    console.error(err);
    regMsg.style.color='red';
    if(err.code === 'auth/email-already-in-use'){
      regMsg.innerText = '‡¶è‡¶á ‡¶á‡¶Æ‡ßá‡¶á‡¶≤‡¶ü‡¶ø ‡¶Ü‡¶ó‡ßá ‡¶•‡ßá‡¶ï‡ßá‡¶á ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡ßÉ‡¶§‡•§ ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ/‡¶á‡¶Æ‡ßá‡¶á‡¶≤ try ‡¶ï‡¶∞‡ßã‡•§';
    } else if(err.code === 'auth/weak-password'){
      regMsg.innerText = '‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶ñ‡ßÅ‡¶¨ ‡¶¶‡ßÅ‡¶∞‡ßç‡¶¨‡¶≤‡•§ ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß¨ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∞‡ßá‡¶ï‡ßç‡¶ü‡¶æ‡¶∞ ‡¶¶‡¶ø‡¶®‡•§';
    } else if(err.code === 'auth/invalid-email'){
      regMsg.innerText = '‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü ‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡ßü‡•§';
    } else {
      regMsg.innerText = '‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá: ' + (err.message || err.code);
    }
  }
}

async function createAccountFromPage(){
  const fullName = document.getElementById('newFullName').value.trim();
  const username = document.getElementById('newUsername').value.trim();
  const pass = document.getElementById('newPassword').value;
  const confirm = document.getElementById('confirmPassword').value;
  const msgEl = document.getElementById('accountMsg');
  msgEl.style.color='black'; msgEl.innerText='Processing...';
  if(!fullName){ msgEl.style.color='red'; msgEl.innerText='Full Name ‡¶≤‡¶æ‡¶ó‡¶¨‡ßá‡•§'; return; }
  if(!username){ msgEl.style.color='red'; msgEl.innerText='Username ‡¶≤‡¶æ‡¶ó‡¶¨‡ßá‡•§'; return; }
  if(!pass || !confirm){ msgEl.style.color='red'; msgEl.innerText='‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶ì ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶≤‡¶æ‡¶ó‡¶¨‡ßá‡•§'; return; }
  if(pass !== confirm){ msgEl.style.color='red'; msgEl.innerText='‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶Æ‡ßá‡¶≤‡ßá‡¶®‡¶ø‡•§'; return; }
  let san = username.replace(/\s+/g,'').toLowerCase();
  if(!san) san = 'user' + Date.now();
  const email = san + '@gmail.com';
  try{
    await firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL);
    const userCred = await firebase.auth().createUserWithEmailAndPassword(email, pass);
    await userCred.user.updateProfile({displayName: username});
    await firebase.database().ref('users/' + userCred.user.uid).set({
      username: username, email: email, fullName: fullName, createdAt: new Date().toISOString()
    });
    cachedProfileInfo = {
      fullName: fullName,
      username: username,
      email: email
    };
    msgEl.style.color='green'; msgEl.innerText='‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶∏‡¶´‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§';
    setTimeout(()=>{ document.getElementById('createAccountPage').style.display='none'; },800);
  }catch(e){
    console.error(e);
    msgEl.style.color='red'; msgEl.innerText='Error: ' + (e.message || e.code);
  }
}

// --------- Profile Modal Logic (NOW BLENDED WITH LOGIN STATE) -------------
function openProfileModal() {
  const user = firebase.auth().currentUser;
  if (!user) {
    profileModalTitle.textContent = "Account";
    profileFields.style.display = "none";
    profileLoginOption.style.display = "flex";
  } else {
    profileModalTitle.textContent = "Profile Info";
    profileFields.style.display = "block";
    profileLoginOption.style.display = "none";
    if (cachedProfileInfo && cachedProfileInfo.fullName) {
      profileFullName.textContent = cachedProfileInfo.fullName;
      profileUserName.textContent = cachedProfileInfo.username || (user.displayName || "");
      profileEmail.textContent = cachedProfileInfo.email || (user.email || "");
    } else {
      const userId = user.uid;
      firebase.database().ref('users/' + userId).once('value').then(snap=>{
        let info = snap.val();
        profileFullName.textContent = (info && info.fullName) ? info.fullName : (user.displayName||user.email||"User");
        profileUserName.textContent = (info && info.username) ? info.username : (user.displayName||"");
        profileEmail.textContent = (info && info.email) ? info.email : (user.email||"");
        cachedProfileInfo = {
          fullName: (info && info.fullName) ? info.fullName : (user.displayName||user.email||"User"),
          username: (info && info.username) ? info.username : (user.displayName||""),
          email: (info && info.email) ? info.email : (user.email||"")
        };
      }).catch(()=>{
        profileFullName.textContent = user.displayName || user.email || "User";
        profileUserName.textContent = user.displayName || user.email || "";
        profileEmail.textContent = user.email || "";
      });
    }
  }
  profileModal.style.display="flex";
  profileModal.setAttribute('aria-hidden','false');
}
function closeProfileModal() {
  profileModal.style.display="none";
  profileModal.setAttribute('aria-hidden','true');
}
profileModal.addEventListener('click', function(e){
  if(e.target === profileModal){ closeProfileModal(); }
});

async function loginUser(){
  loginMsg.style.color='black'; loginMsg.innerText='Processing...';
  let emailOrUsername = document.getElementById('loginEmail').value.trim();
  const pass = document.getElementById('loginPassword').value;
  if(!emailOrUsername || !pass){ loginMsg.style.color='red'; loginMsg.innerText='Email/Username ‡¶è‡¶¨‡¶Ç Password ‡¶≤‡¶æ‡¶ó‡¶¨‡ßá‡•§'; return; }
  let email = emailOrUsername;
  if(!email.includes('@')) {
    const san = emailOrUsername.replace(/\s+/g,'').toLowerCase();
    email = (san || ('user'+Date.now())) + '@gmail.com';
  }
  try{
    await firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL);
    await firebase.auth().signInWithEmailAndPassword(email, pass);
    loginMsg.style.color='green'; loginMsg.innerText='‚úÖ ‡¶≤‡¶ó‡¶á‡¶® ‡¶∏‡¶´‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§';
    setTimeout(()=>{ closeAuthModal(); },700);
  }catch(err){
    console.error(err);
    loginMsg.style.color='red';
    if(err.code === 'auth/user-not-found') loginMsg.innerText='‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§ ‡¶Ü‡¶ó‡ßá ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßã‡•§';
    else if(err.code === 'auth/wrong-password') loginMsg.innerText='‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤‡•§';
    else loginMsg.innerText = 'Error: ' + (err.message || err.code);
  }
}

function logoutUser(){
  firebase.auth().signOut().then(()=>{
    closeProfileModal();
  }).catch(e=>{
    alert('Logout error: ' + (e.message||e.code));
  });
}

// Always show profile button, just update info/menu by login state
let isLoggedIn = false;
firebase.auth().onAuthStateChanged(user=>{
  if(user){
    isLoggedIn = true;
    const userId = user.uid;
    firebase.database().ref('users/' + userId).once('value').then(snap=>{
      let info = snap.val();
      cachedProfileInfo = {
        fullName: (info && info.fullName) ? info.fullName : ((user.displayName) ? user.displayName : (user.email ? user.email.split('@')[0] : 'User')),
        username: (info && info.username) ? info.username : (user.displayName ? user.displayName : (user.email ? user.email.split('@')[0] : "")),
        email: (info && info.email) ? info.email : (user.email || "")
      };
      const label = document.getElementById('userLabel');
      if(label){
        label.textContent = cachedProfileInfo.fullName || cachedProfileInfo.username || '';
        label.style.display = (window.innerWidth >= 980) ? 'inline-block' : 'none';
      }
      const btn = document.getElementById('profileBtn');
      if(btn && cachedProfileInfo.fullName){
        btn.title = (cachedProfileInfo.fullName + ' ‚Äî Profile');
      }
    }).catch(()=>{
      cachedProfileInfo = {
        fullName: user.displayName || (user.email ? user.email.split('@')[0] : 'User'),
        username: user.displayName || (user.email ? user.email.split('@')[0] : ""),
        email: user.email || ""
      };
    });
  } else {
    isLoggedIn = false;
    cachedProfileInfo = {};
    closeProfileModal();
    const label = document.getElementById('userLabel');
    if(label) label.style.display = 'none';
  }
});

// ----------------- PRODUCTS & ORDERS (existing) -----------------
function renderProducts(products){
  homeContainer.innerHTML='';
  products.forEach((p,i)=>{
    const d=document.createElement('div');
    d.className='product';
    d.onclick=()=>showProductPage(i, products);
    d.innerHTML=`<img src="${p.homeImg||'https://via.placeholder.com/400x300?text=No+Image'}" alt="${escapeHtml(p.name||'Product image')}"><div class="product-info"><h3>${escapeHtml(p.name||'Untitled')}</h3><p>${escapeHtml(p.price||'‡ß≥ 0')}</p></div>`;
    homeContainer.appendChild(d);
  });
}
function showProductPage(i, products){
  selectedProduct = products[i];
  document.getElementById('home').style.display='none';
  document.getElementById('productPage').style.display='block';
  if(header) header.style.display='none';
  document.getElementById('shopNameWrapper').style.display='none';
  document.getElementById('detailName').innerText=selectedProduct.name||'Product';
  document.getElementById('detailPrice').innerText=selectedProduct.price||'‡ß≥ 0';
  document.getElementById('productDescFrame').innerText=selectedProduct.desc||'';
  const imagesCol = document.getElementById('detailImagesColumn');
  imagesCol.innerHTML='';
  const imageKeys = ['detailImg1','detailImg2','detailImg3','detailImg4'];
  imageKeys.forEach(key=>{
    if(selectedProduct[key]){
      const imgWrap=document.createElement('div');
      imgWrap.className='imgWrap';
      const imgEl=document.createElement('img');
      imgEl.src=selectedProduct[key];
      imgEl.alt = selectedProduct.name || 'Product detail';
      imgEl.onclick=()=>openFullscreen(selectedProduct[key]);
      imgWrap.appendChild(imgEl);
      imagesCol.appendChild(imgWrap);
    }
  });
  document.getElementById('orderBtn').onclick=(e)=>{
    e.preventDefault();
    if(!isLoggedIn){
      openOrderAlertModal();
      return;
    }
    openOrderForm();
  };
}
function openFullscreen(src){
  const div=document.createElement('div');
  div.className='fullscreen-view closeable';
  div.onclick=()=>div.remove();
  const img=document.createElement('img');
  img.src=src;
  div.appendChild(img);
  document.body.appendChild(div);
}
function openOrderForm(){
  document.getElementById('productPage').style.display='none';
  document.getElementById('orderFormPage').style.display='block';
  window.scrollTo({top:0,behavior:'smooth'});
}
function confirmOrder(){
  if(!isLoggedIn){
    openOrderAlertModal();
    return;
  }
  const last4=document.getElementById('lastFourDigits').value.trim();
  const uid=document.getElementById('userUID').value.trim();
  const msgEl=document.getElementById('orderMsg');
  if(last4.length!==4||isNaN(last4)){msgEl.style.color='red';msgEl.innerText='‡¶∏‡¶†‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶∂‡ßá‡¶∑ ‡ß™ ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü ‡¶¶‡¶ø‡¶®!';return;}
  if(uid===''){msgEl.style.color='red';msgEl.innerText='UID ‡¶¶‡¶ø‡¶®!';return;}
  const orderData={productName:selectedProduct?selectedProduct.name:'Unknown',productPrice:selectedProduct?selectedProduct.price:'‡ß≥ 0',lastFour:last4,UID:uid,time:new Date().toLocaleString()};
  firebase.database().ref('orders').push(orderData).then(()=>{
    msgEl.style.color='green';msgEl.innerText='‚úÖ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!';document.getElementById('lastFourDigits').value='';
    document.getElementById('userUID').value='';
  }).catch(e=>{
    msgEl.style.color='red';
    msgEl.innerText='‚ùå ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá, ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®!';
  });
}

// ‚úÖ Back Button Function -- keeps pages tidy and restores view
function goBack(currentPage){
  if(currentPage==='productPage'){
    document.getElementById('productPage').style.display='none';
    document.getElementById('home').style.display='grid';
    if(header) header.style.display='block';
    document.getElementById('shopNameWrapper').style.display='flex';
  } else if(currentPage==='orderFormPage'){
    document.getElementById('orderFormPage').style.display='none';
    document.getElementById('productPage').style.display='block';
    window.scrollTo({top:0,behavior:'smooth'});
  } else if(currentPage==='createAccountPage'){
    document.getElementById('createAccountPage').style.display='none';
  }
}

dbRef.on('value', snap=>{
  const data=snap.val();
  if(!data)return;
  if(data.shopName)shopNameDiv.innerText=data.shopName;
  if(data.headerText && header) header.innerText=data.headerText;
  if(data.products)renderProducts(Object.values(data.products));
});
</script>

<script>
// ‚úÖ Copy Function (with small UX feedback)
function copyText(elementId){
  const el = document.getElementById(elementId);
  if(!el) return;
  const text = el.innerText;
  if(!navigator.clipboard) {
    const textarea = document.createElement('textarea');
    textarea.value = text;
    document.body.appendChild(textarea);
    textarea.select();
    document.execCommand('copy');
    textarea.remove();
  } else {
    navigator.clipboard.writeText(text).catch(()=>{ /* ignore */ });
  }
  // show transient feedback on the nearby button
  const btns = document.querySelectorAll('.copyBtn');
  btns.forEach(btn=>{
    if(btn && btn.previousElementSibling && btn.previousElementSibling.id === elementId){
      const originalText = btn.innerText;
      btn.innerText = 'Copied ‚úÖ';
      setTimeout(()=>{btn.innerText = originalText;},1200);
    }
  });
}
</script>
</body>
</html>